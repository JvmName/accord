#!/usr/bin/env node

const { HttpClient } = require('../lib/http/client');
const { io }         = require('socket.io-client');


class ApiClient extends HttpClient { get urlRoot() { return apiRoot; } }
const apiRoot     = "http://localhost:3000";
const markToken   = 'bab61d9d-4e8d-4f56-bba9-f879747dbf92';
const bruceToken  = '7f9de9bc-88c5-41cc-bc08-14b37215c141';
const damianToken = 'f5a0c2b6-1651-42b1-a2cd-ec5f1fa9d653';
const headers     = {'x-api-token': markToken};
const matCode     = 'crow.wolf.camel';


async function makeRequest() {
    const client   = new ApiClient();
    const options  = { headers };
    try {
        const { data } = await client.get(`/mat/${matCode}/viewers`, options);
        console.log(data.data);
    } catch(err) {
        console.log("ERROR:", JSON.stringify(await err.data()));
    }
}


async function connectToWebSocket() {
    const socket = io(apiRoot, {
        auth: {apiToken: markToken}
    });
    socket.on("connect", () => {console.log("Web socket connected")});
    socket.on("disconnect", () => {console.log("Web socket disconnected")});
}


makeRequest();
connectToWebSocket();
